var R=Object.defineProperty,D=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var H=(t,l,r)=>l in t?R(t,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[l]=r,y=(t,l)=>{for(var r in l||(l={}))q.call(l,r)&&H(t,r,l[r]);if(N)for(var r of N(l))B.call(l,r)&&H(t,r,l[r]);return t},j=(t,l)=>D(t,I(l));var p=(t,l,r)=>new Promise((c,o)=>{var s=m=>{try{d(r.next(m))}catch(h){o(h)}},n=m=>{try{d(r.throw(m))}catch(h){o(h)}},d=m=>m.done?c(m.value):Promise.resolve(m.value).then(s,n);d((r=r.apply(t,l)).next())});import{j as a,z as f}from"./ui-vendor-BkLQtwW7.js";import{r as e}from"./react-vendor-DbADd6nL.js";import{c as O,a as x}from"./state-vendor-DhTtZAk7.js";import{p as E}from"./index-Bfp0FfWb.js";import{n as C}from"./Tag.es-D2iydmKm.js";import{n as U}from"./Trash.es-pugggUhK.js";const G=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M203.57,51A107.9,107.9,0,0,0,20,128c0,44.72,27.6,82.25,72,97.94A36,36,0,0,0,140,192a12,12,0,0,1,12-12h46.21a35.79,35.79,0,0,0,35.1-28A108.6,108.6,0,0,0,236,127.09,107.23,107.23,0,0,0,203.57,51Zm6.34,95.67a11.91,11.91,0,0,1-11.7,9.3H152a36,36,0,0,0-36,36,12,12,0,0,1-16,11.3c-16.65-5.88-30.65-15.76-40.48-28.56A76,76,0,0,1,44,128a84,84,0,0,1,83.13-84H128a84.35,84.35,0,0,1,84,83.29A84.72,84.72,0,0,1,209.91,146.71ZM144,76a16,16,0,1,1-16-16A16,16,0,0,1,144,76Zm-44,24A16,16,0,1,1,84,84,16,16,0,0,1,100,100Zm0,56a16,16,0,1,1-16-16A16,16,0,0,1,100,156Zm88-56a16,16,0,1,1-16-16A16,16,0,0,1,188,100Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,127.17a96.48,96.48,0,0,1-2.39,22.18A24,24,0,0,1,198.21,168H152a24,24,0,0,0-24,24,24,24,0,0,1-32,22.61C58.73,201.44,32,169.81,32,128a96,96,0,0,1,95-96C179.84,31.47,223.55,74.35,224,127.17Z",opacity:"0.2"}),e.createElement("path",{d:"M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89Zm13,93.71A15.89,15.89,0,0,1,198.21,160H152a32,32,0,0,0-32,32,16,16,0,0,1-21.31,15.07C62.49,194.3,40,164,40,128a88,88,0,0,1,87.09-88h.9a88.35,88.35,0,0,1,88,87.25A88.86,88.86,0,0,1,213.81,147.6ZM140,76a12,12,0,1,1-12-12A12,12,0,0,1,140,76ZM96,100A12,12,0,1,1,84,88,12,12,0,0,1,96,100Zm0,56a12,12,0,1,1-12-12A12,12,0,0,1,96,156Zm88-56a12,12,0,1,1-12-12A12,12,0,0,1,184,100Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89ZM84,168a12,12,0,1,1,12-12A12,12,0,0,1,84,168Zm0-56a12,12,0,1,1,12-12A12,12,0,0,1,84,112Zm44-24a12,12,0,1,1,12-12A12,12,0,0,1,128,88Zm44,24a12,12,0,1,1,12-12A12,12,0,0,1,172,112Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M199.37,55.31A101.32,101.32,0,0,0,128,26h-1A102,102,0,0,0,26,128c0,42.09,26.07,77.44,68,92.26A30.21,30.21,0,0,0,104.11,222,30.06,30.06,0,0,0,134,192a18,18,0,0,1,18-18h46.21a29.82,29.82,0,0,0,29.25-23.31A102.71,102.71,0,0,0,230,127.11,101.25,101.25,0,0,0,199.37,55.31ZM215.76,148a17.89,17.89,0,0,1-17.55,14H152a30,30,0,0,0-30,30,18,18,0,0,1-24,17C61,195.86,38,164.85,38,128a90,90,0,0,1,89.07-90H128a90.34,90.34,0,0,1,90,89.22A90.46,90.46,0,0,1,215.76,148ZM138,76a10,10,0,1,1-10-10A10,10,0,0,1,138,76ZM94,100A10,10,0,1,1,84,90,10,10,0,0,1,94,100Zm0,56a10,10,0,1,1-10-10A10,10,0,0,1,94,156Zm88-56a10,10,0,1,1-10-10A10,10,0,0,1,182,100Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M200.77,53.89A103.27,103.27,0,0,0,128,24h-1.07A104,104,0,0,0,24,128c0,43,26.58,79.06,69.36,94.17A32,32,0,0,0,136,192a16,16,0,0,1,16-16h46.21a31.81,31.81,0,0,0,31.2-24.88,104.43,104.43,0,0,0,2.59-24A103.28,103.28,0,0,0,200.77,53.89Zm13,93.71A15.89,15.89,0,0,1,198.21,160H152a32,32,0,0,0-32,32,16,16,0,0,1-21.31,15.07C62.49,194.3,40,164,40,128a88,88,0,0,1,87.09-88h.9a88.35,88.35,0,0,1,88,87.25A88.86,88.86,0,0,1,213.81,147.6ZM140,76a12,12,0,1,1-12-12A12,12,0,0,1,140,76ZM96,100A12,12,0,1,1,84,88,12,12,0,0,1,96,100Zm0,56a12,12,0,1,1-12-12A12,12,0,0,1,96,156Zm88-56a12,12,0,1,1-12-12A12,12,0,0,1,184,100Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M198,56.74A99.31,99.31,0,0,0,128,28h-1A100,100,0,0,0,28,128c0,41.22,25.55,75.85,66.69,90.38a28.34,28.34,0,0,0,9.42,1.63A28,28,0,0,0,132,192a20,20,0,0,1,20-20h46.21a27.84,27.84,0,0,0,27.3-21.76,100.37,100.37,0,0,0,2.49-23.1A99.26,99.26,0,0,0,198,56.74Zm19.74,91.72A19.89,19.89,0,0,1,198.21,164H152a28,28,0,0,0-28,28,20,20,0,0,1-26.64,18.83C59.51,197.46,36,165.72,36,128a92,92,0,0,1,91.05-92H128a92,92,0,0,1,89.72,112.46ZM136,76a8,8,0,1,1-8-8A8,8,0,0,1,136,76ZM92,100a8,8,0,1,1-8-8A8,8,0,0,1,92,100Zm0,56a8,8,0,1,1-8-8A8,8,0,0,1,92,156Zm88-56a8,8,0,1,1-8-8A8,8,0,0,1,180,100Z"}))]]),J=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M221.66,90.34,192,120,136,64l29.66-29.66a8,8,0,0,1,11.31,0L221.66,79A8,8,0,0,1,221.66,90.34Z",opacity:"0.2"}),e.createElement("path",{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM51.31,160,136,75.31,152.69,92,68,176.68ZM48,179.31,76.69,208H48Zm48,25.38L79.31,188,164,103.31,180.69,120Zm96-96L147.31,64l24-24L216,84.68Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM51.31,160l90.35-90.35,16.68,16.69L68,176.68ZM48,179.31,76.69,208H48Zm48,25.38L79.31,188l90.35-90.35h0l16.68,16.69Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M225.9,74.78,181.21,30.09a14,14,0,0,0-19.8,0L38.1,153.41a13.94,13.94,0,0,0-4.1,9.9V208a14,14,0,0,0,14,14H92.69a13.94,13.94,0,0,0,9.9-4.1L225.9,94.58a14,14,0,0,0,0-19.8ZM48.49,160,136,72.48,155.51,92,68,179.51ZM46,208V174.48L81.51,210H48A2,2,0,0,1,46,208Zm50-.49L76.49,188,164,100.48,183.51,120ZM217.41,86.1,192,111.51,144.49,64,169.9,38.58a2,2,0,0,1,2.83,0l44.68,44.69a2,2,0,0,1,0,2.83Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM51.31,160,136,75.31,152.69,92,68,176.68ZM48,179.31,76.69,208H48Zm48,25.38L79.31,188,164,103.31,180.69,120Zm96-96L147.31,64l24-24L216,84.68Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224.49,76.2,179.8,31.51a12,12,0,0,0-17,0L39.52,154.83A11.9,11.9,0,0,0,36,163.31V208a12,12,0,0,0,12,12H92.69a12,12,0,0,0,8.48-3.51L224.48,93.17a12,12,0,0,0,0-17ZM45.66,160,136,69.65,158.34,92,68,182.34ZM44,208V169.66l21.17,21.17h0L86.34,212H48A4,4,0,0,1,44,208Zm52,2.34L73.66,188,164,97.65,186.34,120ZM218.83,87.51,192,114.34,141.66,64l26.82-26.83a4,4,0,0,1,5.66,0l44.69,44.68a4,4,0,0,1,0,5.66Z"}))]]),K=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M216,56V200a16,16,0,0,1-16,16H56a16,16,0,0,1-16-16V56A16,16,0,0,1,56,40H200A16,16,0,0,1,216,56Z",opacity:"0.2"}),e.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM184,136H136v48a8,8,0,0,1-16,0V136H72a8,8,0,0,1,0-16h48V72a8,8,0,0,1,16,0v48h48a8,8,0,0,1,0,16Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M222,128a6,6,0,0,1-6,6H134v82a6,6,0,0,1-12,0V134H40a6,6,0,0,1,0-12h82V40a6,6,0,0,1,12,0v82h82A6,6,0,0,1,222,128Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M220,128a4,4,0,0,1-4,4H132v84a4,4,0,0,1-8,0V132H40a4,4,0,0,1,0-8h84V40a4,4,0,0,1,8,0v84h84A4,4,0,0,1,220,128Z"}))]]),V=e.forwardRef((t,l)=>e.createElement(E,j(y({ref:l},t),{weights:G})));V.displayName="PaletteIcon";const Q=V,T=e.forwardRef((t,l)=>e.createElement(E,j(y({ref:l},t),{weights:J})));T.displayName="PencilIcon";const W=T,F=e.forwardRef((t,l)=>e.createElement(E,j(y({ref:l},t),{weights:K})));F.displayName="PlusIcon";const X=F,Y=O((t,l)=>({tags:[],currentTag:null,isLoading:!1,error:null,fetchTags:()=>p(void 0,null,function*(){var r,c;t({isLoading:!0,error:null});try{const o=yield x.get("/api/tags"),{tags:s}=o.data;return t({tags:s,isLoading:!1,error:null}),{success:!0,tags:s}}catch(o){const s=((c=(r=o.response)==null?void 0:r.data)==null?void 0:c.error)||"获取标签列表失败";return t({error:s,isLoading:!1}),{success:!1,error:s}}}),createTag:r=>p(void 0,null,function*(){var c,o;t({isLoading:!0,error:null});try{const s=yield x.post("/api/tags",r),{tag:n}=s.data;return t(d=>({tags:[...d.tags,n],isLoading:!1,error:null})),{success:!0,tag:n}}catch(s){const n=((o=(c=s.response)==null?void 0:c.data)==null?void 0:o.error)||"创建标签失败";return t({error:n,isLoading:!1}),{success:!1,error:n}}}),updateTag:(r,c)=>p(void 0,null,function*(){var o,s;t({isLoading:!0,error:null});try{const n=yield x.put(`/api/tags/${r}`,c),{tag:d}=n.data;return t(m=>({tags:m.tags.map(h=>h.id===r?d:h),isLoading:!1,error:null})),{success:!0,tag:d}}catch(n){const d=((s=(o=n.response)==null?void 0:o.data)==null?void 0:s.error)||"更新标签失败";return t({error:d,isLoading:!1}),{success:!1,error:d}}}),deleteTag:r=>p(void 0,null,function*(){var c,o;t({isLoading:!0,error:null});try{return yield x.delete(`/api/tags/${r}`),t(s=>({tags:s.tags.filter(n=>n.id!==r),isLoading:!1,error:null})),{success:!0}}catch(s){const n=((o=(c=s.response)==null?void 0:c.data)==null?void 0:o.error)||"删除标签失败";return t({error:n,isLoading:!1}),{success:!1,error:n}}}),batchTagOperation:(r,c,o)=>p(void 0,null,function*(){var s,n;t({isLoading:!0,error:null});try{return yield x.post("/api/tags/batch",{action:r,imageIds:c,tagIds:o}),t({isLoading:!1,error:null}),{success:!0}}catch(d){const m=((n=(s=d.response)==null?void 0:s.data)==null?void 0:n.error)||"批量操作失败";return t({error:m,isLoading:!1}),{success:!1,error:m}}}),getTagImages:r=>p(void 0,null,function*(){var c,o;t({isLoading:!0,error:null});try{const s=yield x.get(`/api/tags/${r}/images`),{images:n}=s.data;return t({isLoading:!1,error:null}),{success:!0,images:n}}catch(s){const n=((o=(c=s.response)==null?void 0:c.data)==null?void 0:o.error)||"获取标签图片失败";return t({error:n,isLoading:!1}),{success:!1,error:n}}}),setCurrentTag:r=>{t({currentTag:r})},findTagByName:r=>l().tags.find(c=>c.name===r),getTagCount:()=>l().tags.length,clearError:()=>{t({error:null})},reset:()=>{t({tags:[],currentTag:null,error:null})}})),l1=()=>{const{tags:t,isLoading:l,fetchTags:r,createTag:c,updateTag:o,deleteTag:s}=Y(),[n,d]=e.useState(!1),[m,h]=e.useState(!1),[k,w]=e.useState(null),[b,A]=e.useState(""),[Z,M]=e.useState("#fef08a");e.useEffect(()=>{r()},[r]);const S=i=>p(void 0,null,function*(){if(i.preventDefault(),!b.trim())return f.error("标签得有个名字！");const u=yield c({name:b,color:Z});u.success?(f.success("便利贴贴好了！"),d(!1),A(""),M("#fef08a")):f.error(u.error)}),$=i=>{w(i),A(i.name),M(i.color),h(!0)},z=i=>p(void 0,null,function*(){if(i.preventDefault(),!b.trim())return f.error("标签得有个名字！");const u=yield o(k.id,{name:b,color:Z});u.success?(f.success("便利贴改好了！"),h(!1),w(null),A("")):f.error(u.error)}),P=i=>p(void 0,null,function*(){if(window.confirm("把这张便利贴揉成团扔掉？")){const u=yield s(i);u.success?f.success("便利贴已扔进垃圾桶。"):f.error(u.error)}}),L=({title:i,onSubmit:u,onClose:v})=>a.jsx("div",{className:"fixed inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:v,children:a.jsxs("div",{className:"bg-white p-6 max-w-sm w-full shadow-sketch rotate-slight-1 relative border border-gray-200",onClick:g=>g.stopPropagation(),children:[a.jsx("div",{className:"tape-top"}),a.jsx("h3",{className:"text-2xl font-hand font-bold text-pencil mb-6 text-center",children:i}),a.jsxs("form",{onSubmit:u,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block font-hand text-lg text-gray-500 mb-1",children:"标签名"}),a.jsx("input",{type:"text",className:"input-hand w-full text-xl",value:b,onChange:g=>A(g.target.value),placeholder:"重要的事情",autoFocus:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-hand text-lg text-gray-500 mb-1",children:"记号笔颜色"}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[["#fef08a","#fbcfe8","#bae6fd","#bbf7d0","#e9d5ff"].map(g=>a.jsx("button",{type:"button",onClick:()=>M(g),className:`w-8 h-8 rounded-full border-2 transition-transform hover:scale-110 ${Z===g?"border-pencil scale-110 shadow-sm":"border-transparent"}`,style:{backgroundColor:g}},g)),a.jsx("input",{type:"color",value:Z,onChange:g=>M(g.target.value),className:"w-8 h-8 opacity-0 absolute"}),a.jsx("button",{type:"button",className:"w-8 h-8 rounded-full border-2 border-dashed border-gray-300 flex items-center justify-center text-gray-400 hover:text-pencil hover:border-pencil",children:a.jsx(Q,{size:16})})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t-2 border-dashed border-gray-100 mt-6",children:[a.jsx("button",{type:"button",onClick:v,className:"btn-doodle text-sm px-4",children:"取消"}),a.jsx("button",{type:"submit",className:"btn-primary text-sm px-4",children:"保存"})]})]})]})});return a.jsxs("div",{className:"animate-in fade-in duration-500",children:[a.jsxs("div",{className:"flex justify-between items-end mb-8 border-b-2 border-dashed border-gray-200 pb-4",children:[a.jsxs("div",{children:[a.jsxs("h1",{className:"text-4xl font-hand font-bold text-pencil rotate-slight-1",children:[a.jsx(C,{className:"inline mr-2",weight:"duotone"})," 标签"]}),a.jsx("p",{className:"text-gray-400 font-hand mt-1 rotate-slight-n1",children:"给脑子的便利贴"})]}),a.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-1 rotate-1",children:[a.jsx(X,{size:20,weight:"bold"})," 新便利贴"]})]}),l?a.jsx("div",{className:"flex justify-center py-20 font-hand text-xl text-pencil animate-bounce",children:"正在检查软木板..."}):t.length===0?a.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-gray-200 rounded-lg bg-gray-50/50",children:[a.jsx(C,{size:64,className:"mx-auto text-gray-300 mb-4"}),a.jsx("p",{className:"font-hand text-xl text-gray-400",children:"没找到便利贴。"})]}):a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4",children:t.map((i,u)=>a.jsxs("div",{className:`
                aspect-square p-4 shadow-sketch relative flex flex-col justify-between transition-transform hover:scale-105 group
                ${u%2===0?"rotate-1":"-rotate-1"}
              `,style:{backgroundColor:i.color},children:[a.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-8 rounded-full bg-black/10 backdrop-blur-sm border-2 border-white/50 shadow-inner"})," ",a.jsxs("div",{className:"mt-4 flex-1 flex flex-col items-center justify-center text-center",children:[a.jsx("h3",{className:"font-hand text-2xl font-bold text-pencil break-words w-full",children:i.name}),a.jsxs("p",{className:"font-hand text-sm text-pencil/60 mt-1",children:[i.count||0," 张涂鸦"]})]}),a.jsxs("div",{className:"flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx("button",{onClick:()=>$(i),className:"p-2 hover:bg-white/50 rounded-full text-pencil",title:"重写",children:a.jsx(W,{size:20})}),a.jsx("button",{onClick:()=>P(i.id),className:"p-2 hover:bg-white/50 rounded-full text-red-500",title:"丢弃",children:a.jsx(U,{size:20})})]})]},i.id))}),n&&a.jsx(L,{title:"新便利贴",onSubmit:S,onClose:()=>d(!1)}),m&&a.jsx(L,{title:"重写便利贴",onSubmit:z,onClose:()=>h(!1)})]})};export{l1 as default};
